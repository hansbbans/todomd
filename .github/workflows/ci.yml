name: CI

on:
  push:
  pull_request:

jobs:
  build-test:
    runs-on: macos-15
    timeout-minutes: 45

    steps:
      - uses: actions/checkout@v4

      - name: Show Toolchain Versions
        run: |
          xcodebuild -version
          swift --version

      - name: Install Tooling
        run: brew install xcodegen swiftlint swiftformat

      - name: Generate Project
        run: xcodegen generate

      - name: Lint
        run: swiftlint --strict --config .swiftlint.yml

      - name: Format Check
        run: swiftformat . --lint --config .swiftformat

      - name: Swift Package Tests
        run: swift test

      - name: Simulator Build
        run: xcodebuild -project TodoMD.xcodeproj -scheme TodoMDApp -configuration Debug -destination 'generic/platform=iOS Simulator' build

      - name: Device Build
        run: xcodebuild -project TodoMD.xcodeproj -scheme TodoMDApp -configuration Release -destination 'generic/platform=iOS' CODE_SIGNING_ALLOWED=NO build
